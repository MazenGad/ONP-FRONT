<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      background-color: #f4f6f9;
    }
    aside {
  position: fixed;
  top: 0;
  left: 0;
  width: 220px;
  height: 100vh;
  background-color: #1f2937;
  color: white;
  padding: 1.5rem;
  overflow-y: auto; /* ÿπÿ¥ÿßŸÜ ÿ™ŸÇÿØÿ± ÿ™ÿπŸÖŸÑ Scroll ÿØÿßÿÆŸÑŸá ŸÑŸà ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ∑ŸàŸäŸÑ */
}

    aside h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }
    aside ul {
      list-style: none;
      padding: 0;
    }
    aside li {
      margin: 0.7rem 0;
    }
    aside a {
      padding: 0.5rem;
  display: flex;
  align-items: center;
  gap: 10px;
  color: white;
  text-decoration: none;
  border-radius: 4px;
  transition: background 0.2s ease;
    }
    aside a:hover {
  background-color: #374151;
}
    aside a.active {
      background-color: #2563eb;
      font-weight: bold;
    }
    main {
      flex-grow: 1;
      padding: 2rem;
      margin-left: 220px; /* ŸÜŸÅÿ≥ ÿπÿ±ÿ∂ ÿßŸÑŸÄ sidebar */

    }
    h1 { margin-bottom: 1rem; }
    form, table {
      width: 100%;
      background: white;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 2rem;
    }
    input, textarea {
      width: 100%;
      padding: 0.6rem;
      margin-bottom: 1rem;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      background-color: #2563eb;
      color: white;
      cursor: pointer;
    }
    table {
      border-collapse: collapse;
    }
    th, td {
      padding: 1rem;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #2563eb;
      color: white;
    }
    .delete { background-color: #e74c3c; }
    .edit { background-color: #f39c12; }

    section {
      display: none;
    }
    section.active {
      display: block;
    }
    .cards {
      display: flex;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }
    .card {
      flex: 1;
      background: white;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      text-align: center;
    }
    .card h3 {
      margin: 0.5rem 0;
      font-size: 1.2rem;
    }
    .card span {
      font-size: 1.5rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <aside>
    <h2>Admin Dashboard</h2>
    <ul>
      <li><a href="#" onclick="showSection('overview')"><i class="fas fa-chart-line"></i> Overview</a></li>
      <li><a href="#" onclick="showSection('users')"><i class="fas fa-users"></i> Manage Users</a></li>
      <li><a href="#" onclick="showSection('jobs')"><i class="fas fa-briefcase"></i> Manage Jobs</a></li>
      <li><a href="#" onclick="showSection('courses')"><i class="fas fa-graduation-cap"></i> Manage Courses</a></li>
      <li><a href="#" onclick="showSection('snippets')"><i class="fas fa-code"></i> Manage Snippets</a></li>
      <li> <a href="index.html"><i class="fas fa-house-user"></i>Back To Home</a></li>
    </ul>
    
  </aside>

  <main>
    <section id="overview-section" class="active">
      <h1>Dashboard Overview</h1>
      <div class="cards" id="overview-cards"></div>
      <h2>Recent Courses</h2>
      <ul id="recent-courses"></ul>
      <h2>Recent Jobs</h2>
      <ul id="recent-jobs"></ul>
    </section>
    <section id="users-section">
      <h1>Manage Users & Roles</h1>
      <table id="user-table">
        <thead>
          <tr>
            <th>Full Name</th>
            <th>Username</th>
            <th>Roles</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="jobs-section" style="display: none">
      <h1>Manage Job Listings</h1>
      <form id="job-form">
        <input type="hidden" id="job-id">
        <label>Job Title</label>
        <input type="text" id="job-title" required>
        <label>Job Description</label>
        <textarea id="job-content" rows="4" required></textarea>
        <label>Contact Email</label>
        <input type="email" id="job-email" required>
        <button type="submit">Save Job</button>
      </form>

      <table id="jobs-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Email</th>
            <th>Posted</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="courses-section" style="display: none">
      <h1>Manage Courses</h1>
      <table id="courses-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Instructor</th>
            <th>Price</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="snippets-section" style="display: none">
      <h1>Manage Code Snippets</h1>
      <table id="snippets-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>Language</th>
            <th>Author</th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <script>
    const token = localStorage.getItem("token");
    const user = JSON.parse(localStorage.getItem("user") || "null");
    if (!token || !user || !user.roles || !user.roles.includes("Admin")) {
    window.location.href = "unauthorized.html"; // üö´ ŸÖÿ¥ ŸÖÿ≥ŸÖŸàÿ≠ ŸÑŸá
  }
    const headers = {
      'Authorization': `Bearer ${token}`,
      'Content-Type': 'application/json'
    };
    function showSection(section) {
      ['users-section', 'jobs-section', 'courses-section', 'snippets-section' , 'overview-section'].forEach(id => {
        document.getElementById(id).style.display = (id === `${section}-section`) ? 'block' : 'none';
      });
      document.querySelectorAll("aside a").forEach(link => link.classList.remove("active"));
  const targetLink = Array.from(document.querySelectorAll("aside a")).find(a => a.textContent.includes(section.charAt(0).toUpperCase() + section.slice(1)));
  if (targetLink) targetLink.classList.add("active");
    }
    function loadOverview() {
      fetch("http://mazingad-001-site1.ntempurl.com/api/Admin/DashboardOverview", { headers })
        .then(res => res.json())
        .then(data => {
          const cards = document.getElementById("overview-cards");
          cards.innerHTML = `
            <div class="card"><h3>Total Courses</h3><span>${data.totalCourses}</span></div>
            <div class="card"><h3>Total Students</h3><span>${data.totalStudents}</span></div>
            <div class="card"><h3>Total Instructors</h3><span>${data.totalInstructors}</span></div>
            <div class="card"><h3>Total Jobs</h3><span>${data.totalJobs}</span></div>
            <div class="card"><h3>Total Revenue</h3><span>$${data.totalRevenue}</span></div>
          `;

          const recentCourses = document.getElementById("recent-courses");
          recentCourses.innerHTML = data.recentCourses.map(c => `
            <div style="flex: 1 1 250px; background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; align-items: center; text-align: center;">
              <img src="${c.imageUrl || 'images/default-course.jpg'}" alt="Course Image" style="width: 100%; max-width: 220px; height: 120px; object-fit: cover; border-radius: 6px; margin-bottom: 10px;">
              <a href="course-details.html?id=${c.id}" style="font-weight: bold; color: #2563eb; font-size: 1.1rem; text-decoration: none;">${c.title}</a>
              <div style="margin-top: 6px; font-size: 0.9rem; color: #555;">by ${c.instructorName}</div>
              <div style="font-size: 0.9rem; color: #111;">$${c.price}</div>
            </div>
          `).join("");
          recentCourses.style.display = "flex";
          recentCourses.style.flexWrap = "wrap";
          recentCourses.style.gap = "1rem";



          const recentJobs = document.getElementById("recent-jobs");
          recentJobs.innerHTML = data.recentJobs.map(j => `
          <div style="flex: 1 1 250px; background: white; padding: 1rem; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);">
            <h4 style="margin: 0 0 10px; color: #2563eb;">${j.title}</h4>
            <p style="margin: 0; font-size: 0.9rem; color: #333;">üìÖ ${new Date(j.postedAt).toLocaleDateString()}</p>
            <p style="margin: 5px 0 0; font-size: 0.9rem; color: #555;">‚úâÔ∏è ${j.contactEmail}</p>
          </div>
        `).join("");
        recentJobs.style.display = "flex";
        recentJobs.style.flexWrap = "wrap";
        recentJobs.style.gap = "1rem";

        });
    }


    // USERS
    function loadUsers() {
      fetch("http://mazingad-001-site1.ntempurl.com/api/Admin/GetUsers", { headers })
        .then(res => res.json())
        .then(users => {
          const tbody = document.querySelector("#user-table tbody");
          tbody.innerHTML = "";
          users.forEach(user => {
            const tr = document.createElement("tr");
            const rolesArrayEscaped = JSON.stringify(user.userRoles).replace(/"/g, '&quot;');
            tr.innerHTML = `
              <td>${user.fullName}</td>
              <td>${user.userName}</td>
              <td>${user.userRoles.join(', ')}</td>
              <td class="role-controls">
                <select id="role-select-${user.id}">
                  <option value="Student">Student</option>
                  <option value="Instructor">Instructor</option>
                  <option value="Admin">Admin</option>
                </select>
                <button class="add" onclick="addRole('${user.id}')">Add Role</button>
                <button class="edit" onclick='showRemoveRoles("${user.id}", ${rolesArrayEscaped})'>Remove Role</button>
                <button class="delete" onclick="deleteUser('${user.id}')">Delete</button>
              </td>`;
            tbody.appendChild(tr);
          });
        });
    }

    function addRole(userId) {
      const role = document.getElementById(`role-select-${userId}`).value;
      fetch(`http://mazingad-001-site1.ntempurl.com/api/Admin/AddRole?userId=${userId}&role=${role}`, {
        method: 'POST', headers
      }).then(res => res.ok ? loadUsers() : alert("Failed to add role"));
    }

    function showRemoveRoles(userId, roles) {
      const roleToRemove = prompt("Enter role to remove:\n" + roles.join("\n"));
      if (!roleToRemove) return;
      fetch(`http://mazingad-001-site1.ntempurl.com/api/Admin/RemoveRole?userId=${userId}&role=${roleToRemove}`, {
        method: 'POST', headers
      }).then(res => res.text())
        .then(msg => {
          alert("‚úÖ " + msg);
          loadUsers();
        });
    }

    function deleteUser(userId) {
      if (!confirm("Are you sure you want to delete this user?")) return;
      fetch(`http://mazingad-001-site1.ntempurl.com/api/Admin/DeleteUser?userId=${userId}`, {
        method: 'DELETE', headers
      }).then(res => res.ok ? loadUsers() : alert("Failed to delete user"));
    }

    // JOBS
    const jobForm = document.getElementById("job-form");

    function loadJobs() {
      fetch("http://mazingad-001-site1.ntempurl.com/api/Job", { headers })
        .then(res => res.json())
        .then(jobs => {
          const tbody = document.querySelector("#jobs-table tbody");
          tbody.innerHTML = "";
          jobs.forEach(job => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${job.title}</td>
              <td>${job.contactEmail}</td>
              <td>${new Date(job.postedAt).toLocaleDateString()}</td>
              <td>
                <button class="edit" onclick='editJob(${JSON.stringify(job)})'>Edit</button>
                <button class="delete" onclick='deleteJob(${job.id})'>Delete</button>
              </td>`;
            tbody.appendChild(tr);
          });
        });
    }

    function editJob(job) {
      document.getElementById("job-id").value = job.id;
      document.getElementById("job-title").value = job.title;
      document.getElementById("job-content").value = job.content;
      document.getElementById("job-email").value = job.contactEmail;
    }

    function deleteJob(id) {
      if (!confirm("Are you sure you want to delete this job?")) return;
      fetch(`http://mazingad-001-site1.ntempurl.com/api/Job/${id}`, {
        method: 'DELETE', headers
      }).then(res => res.ok ? loadJobs() : alert("Failed to delete job"));
    }

    jobForm.addEventListener("submit", e => {
      e.preventDefault();
      const id = document.getElementById("job-id").value;
      const payload = {
        title: document.getElementById("job-title").value,
        content: document.getElementById("job-content").value,
        contactEmail: document.getElementById("job-email").value
      };

      const method = id ? "PUT" : "POST";
      const url = id ? `http://mazingad-001-site1.ntempurl.com/api/Job/${id}` : "http://mazingad-001-site1.ntempurl.com/api/Job";

      fetch(url, {
        method,
        headers,
        body: JSON.stringify(payload)
      }).then(res => res.ok ? res.text() : Promise.reject("Failed to save job"))
        .then(() => {
          alert("‚úÖ Job saved successfully");
          jobForm.reset();
          loadJobs();
        })
        .catch(err => alert("‚ùå " + err));
    });

    // COURSES
    function loadCourses() {
      fetch("http://mazingad-001-site1.ntempurl.com/api/Admin/GetAllCourses", { headers })
        .then(res => res.json())
        .then(courses => {
          const tbody = document.querySelector("#courses-table tbody");
          tbody.innerHTML = "";
          courses.forEach(course => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${course.title}</td>
              <td>${course.categoryName}</td>
              <td>${course.instructorName}</td>
              <td>${course.price}</td>
              <td>
                <button class="delete" onclick='deleteCourse(${course.id})'>Delete</button>
              </td>`;
            tbody.appendChild(tr);
          });
        });
    }

    function deleteCourse(id) {
      if (!confirm("Are you sure you want to delete this course?")) return;
      fetch(`http://mazingad-001-site1.ntempurl.com/api/Admin/DeleteCourse?courseId=${id}`, {
        method: 'DELETE', headers
      }).then(res => res.ok ? loadCourses() : alert("Failed to delete course"));
    }
    function loadSnippets() {
      fetch("http://mazingad-001-site1.ntempurl.com/api/Admin/GetSnippets", { headers })
        .then(res => res.json())
        .then(snippets => {
          const tbody = document.querySelector("#snippets-table tbody");
          tbody.innerHTML = "";
          snippets.forEach(snippet => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${snippet.title}</td>
              <td>${snippet.language}</td>
              <td>${snippet.authorName}</td>
              <td>${snippet.description || ''}</td>
              <td>
                <button class="delete" onclick="deleteSnippet(${snippet.id})">Delete</button>
              </td>`;
            tbody.appendChild(tr);
          });
        });
    }

    function deleteSnippet(id) {
      if (!confirm("Are you sure you want to delete this snippet?")) return;
      fetch(`http://mazingad-001-site1.ntempurl.com/api/Admin/DeleteSnippet?snippetId=${id}`, {
        method: 'DELETE', headers
      }).then(res => res.ok ? loadSnippets() : alert("Failed to delete snippet"));
    }

    loadOverview();
    loadUsers();
    loadJobs();
    loadCourses();
    loadSnippets();
    const overviewLink = Array.from(document.querySelectorAll("aside a"))
  .find(link => link.textContent.trim().toLowerCase().includes("overview"));
overviewLink?.classList.add("active");

  </script>
</body>
</html>
